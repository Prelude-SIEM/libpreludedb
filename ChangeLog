2002-12-14  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/sql-table.c:
	add missing copyright notice.

2002-12-14  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/db-interface.c:
	allow interface specification with format = NULL

	* src/db-interface.c:
	* src/include/db-interface-h:
	(prelude_db_interface_get_connection)
	(prelude_db_interface_get_connection_data)
	new function.

	* src/sql-table.c:
	* src/include/sql-table.h:
	rename prelude_sql_row_add_field() to prelude_sql_row_set_field()
	to reflect actual behavior. Add new function 
	prelude_sql_row_get_width().

	* plugins/sql/pgsql/pgsql.c(get_query_result):
	fix a bug preventing function from working :-)
	(add missing call to prelude_sql_row_set_field())

2002-12-09  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/include/sql.h:
	* src/include/sql-table.h:
	* src/include/param-string.h:
	add missing copyright notice

	* src/include/param-string.h:
	add missing #ifdef

2002-12-09  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/sql-table.c:
	* src/include/sql-table.h:
	prefix public functions and structures with prelude_ 
	(so all public SQL functions are now prefixed with prelude_sql_)

	* plugins/sql/mysql/mysql.c:
	* plugins/sql/pgsql/pgsql.c:
	* src/sql.c:
	* src/include/sql.h:
	* src/include/plugin-sql.h:
	update accordingly.
	
	* src/include/plugin-sql.h:
	add missing plugin_init() prototype.

	* src/include/format.h:
	removed.

2002-12-09  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/include/format.h:
	* src/sql.c:
	prefix public functions and structures with prelude_ 

	* src/include/format.h:
	* src/db-interface.c:
	* plugins/format/classic/idmef-db-output.c:
	modified accordingly

2002-12-09  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/include/sql.h:
	* src/sql.c:
	SQL connection handling code from sql-plugins.c. sql_connection_t
	structure made opaque. sql.h is a public header, offering
	application access to our SQL layer. 

	* src/sql-plugins.c:
	* src/include/plugin-sql.h:
	remove code moved to sql.[ch].

	* src/Makefile.am:
	* src/include/Makefile.am:
	modified accordingly

	* plugins/format/classic/classic.c:
	* plugins/format/classic/idmef-db-output.c:
	* src/db-interface.c:
	include "sql.h" instead of "plugin-sql.h"


2002-12-07  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/db-interface-string.c:
	remove unneeded includes.

2002-12-07  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/db-interface.c(prelude_db_interface_connect):
	add missing "break" statement

	* src/db-interface-string.c:
	* src/include/db-interface-string.h:
	new file. Reintroducing "ODBC-style" constructor for 
	prelude_db_interface_t.

	* src/Makefile.am:
	* src/include/Makefile.am:
	update accordingly.

2002-12-07  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/sql-connection-data.c:
	handle NULL parameter values correctly in all functions

	* src/include/db-type.h:
	define prelude_db_type_invalid

2002-12-07  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/db-interface.c:
	don't include "param-string.h"

2002-12-07  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/db-interface.c(prelude_db_interface_new):
	avoid problems when 'format' or 'name' parameter is NULL

2002-12-07  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/include/db-type.h:
	new file. prelude_db_type_t moved from db-connection.h

	* src/include/db-connection.h:
	modified accordingly.

	* src/include/Makefile.am:
	modified accordingly.

	* plugins/format/classic/classic.c:
	* plugins/format/classic/idmef-db-output.c:
	* src/db-connection.c:
	* src/db-interface.c:
	* src/db.c:
	* src/format-plugins.c:
	* src/sql-plugins.c:
	include "db-type.h"

	* src/sql-connection-data.c:
	* src/include/sql-connection-data.h:
	(prelude_sql_connection_data_set_name):
	(prelude_sql_connection_data_get_name):
	implemented.

	* src/param-string.c:
	declare local functions as static

2002-12-07  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/db-interface.c:
	* src/include/db-connection-data.c:
	add missing copyright notice

2002-12-07  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/db-connection-data.c
	* src/include/db-connection-data.c
	* src/db-interface.c
	* src/include/db-interface.h
	* src/sql-connection-data.c
	* src/include/sql-connection-data.h
	new files. Object model for connection management has been totally
	reworked using opaque datatypes and should finally be correct. 

	* src/db-connection.c:
	* src/include/db-connection.h:
	remove code regaring interface object (moved to db-interface.[ch]).
	Change structure of prelude_db_connection_t and make opaque.  

	* src/db.c:
	* src/include/db.h:
	don't include anything in .h

	* plugins/format/classic/classic.c:
	* plugins/format/classic/idmef-db-output.c:
	modify code as necessary	

	* plugins/sql/mysql/mysql.c:
	* plugins/sql/pgsql/pgsql.c:
	fix includes accordingly	

	* src/Makefile.am:
	* src/include/Makefile.am:
	modify accordingly

2002-09-24  Yoann Vandoorselaere  <yoann@mandrakesoft.com>

	* src/db-connection.c (prelude_db_interface_new): 
	(prelude_db_interface_set_name): 
	(prelude_db_interface_set_type): 
	(prelude_db_interface_set_format): 
	(prelude_db_interfave_set_host): 
	(prelude_db_interface_set_port): 
	(prelude_db_interface_set_user): 
	(prelude_db_interface_set_pass): 
	(prelude_db_interface_connect): 

	Implemented. We're now using an object oriented model.
	Still, we have to abstract access to the prelude_db_interface_t
	structure which remain pubmic for now.

2002-09-20  Yoann Vandoorselaere  <yoann@mandrakesoft.com>

	* plugins/format/classic/mysql.sql:
	* plugins/format/classic/pgsql.sql: add missing field
	for good File table handling.

	* plugins/format/classic/idmef-db-output.c (insert_file_list):
	increase file_ident on each File insertion.
	(insert_file): take a file_ident argument.

2002-09-18  Yoann Vandoorselaere  <yoann@mandrakesoft.com>

	* plugins/db/mysql/mysql.sql: add the file_ident
	member to the Prelude_Inode table. Add the ident
	member to the Prelude_File table.

2002-09-16  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* plugins/sql/mysql/mysql.sql:
	* plugins/sql/pgsql/postgresql.sql:
	moved to plugins/format/classic (quite logical ;-)). Renamed
	postgresql.sql to pgsql.sql.

2002-09-15  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* plugin/sql/mysql.c:
	* plugin/sql/pgsql.c:
	fixed a serious connection state handling bug (transactions were
	not marked as terminated). Cleanup. 

	* plugin/sql/mysql.c:
	* plugin/sql/pgsql.c:
	* src/sql-plugins.c:
	* src/include/plugins-sql.c:
	remove unnecessary db_insert() in favor of db_command(). 

2002-09-12  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/db-connection.c:
	* src/include/db-connection.h:
	removed support for connection lists. This should be done
	in the application.
	
	Added a new ODBC-style common connection interface 
	(prelude_db_connect).
	
	* src/param-string.c
	* src/include/param-string.h:
	Functions needed for parsing connection configuration strings. 

2002-09-09  Yoann Vandoorselaere  <yoann@mandrakesoft.com>

	* src/idmef-db-output.c (insert_analyzer):
	use parent_type instead of the 'A' string constant.
	Fix a possible IDMEF heartbeat insertion error.


2002-08-27  Yoann Vandoorselaere  <yoann@mandrakesoft.com>

	* src/sql-table.c: made sql_field_t, sql_row_t, sql_table_t
	be opaque datatype, for the sake of binary compatibility.

	* lot of cleanup, handle session the right way (tm).

2002-08-26  Yoann Vandoorselaere  <yoann@mandrakesoft.com>

	* src/sql-plugins.c:
	if va_copy isn't defined (C99), check for __va_copy (C89).

	If __va_copy isn't available, then fallback on the memcpy()
	method, but give a compile warning as well explaining this 
	might result in undefined behavior on certain architecture.

	generate_query(): copy the variable argument list in case
	generate_dynamic_query() is to be called. This avoid undefined
	behavior on some architecture, where you can't use a variable
	argument list twice.
	
	* src/sql-plugins.c (sql_query): 
	(sql_insert): kill code duplication, use generate_query().

	(generate_query): new function. Fix an off by one in 
	sql_insert() and sql_query.

	* configure.in: pre-require autoconf 2.53.

2002-08-25  Yoann Vandoorselaere  <yoann@mandrakesoft.com>

	* src/format-plugins.c: avoid using global variable when
	possible. Style fix.

2002-08-23  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* plugins/db/mysql/mysql.c:
	* plugins/db/pgsql/pgsql.c:
	  fix a bug causing first assigned session ID to have number
	  1 instead of 0.

	* plugins/db/mysql/mysql.c:
	* plugins/db/pgsql/pgsql.c:
	  remove not needed prelude_option stuff

	* plugins/db/mysql/mysql.c:
	* plugins/db/pgsql/pgsql.c:
	* src/sql-plugins.c:
	* include/plugins-sql.h:
	  change db_escape() prototype. Session identifier must be passed
	  to the function so mysql_real_escape_string() can be used. 

        * plugins/db/mysql/mysql.c:
        * plugins/db/pgsql/pgsql.c:
	* plugins/formats/classic/classic.c:
	* plugins/formats/classic/idmef-db-output.c:
	* src/sql-plugins.c:
	  improve error handling and messages, remove debugging printf()'s 
	  and log()'s. 

	* README: new file. Instructions for new users. ;-)


2002-08-23  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* plugins/db/mysql/Makefile.am:
	* plugins/db/mysql/mysql.c:
	  port the plugin to new API. Mostly functional, but missing
	  db_query() function (currently not used). 

	* plugins/db/Makefile.am: enable MySQL plugin

2002-08-22  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* src/db.c 
          src/include/db.h:
          cleanup. No longer dependant on (argc, argv). 
	  Change function prefix to prelude_db.

	* src/db-connection.c, src/include/db-connection.h: 
	  cleanup. Improved database interface handling code. 
	  Change function prefix to prelude_db.

2002-08-22  Krzysztof Zaraska  <kzaraska@student.uci.agh.edu.pl>

	* Initial commit:
	  Supports writing data in old Prelude format to PostgreSQL database.
	  Certain files / directories not (yet) used. Needs cleaning. 

